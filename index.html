<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ImbiLine</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
margin:0;
font-family:'Poppins',sans-serif;
background:#0A1F44;
color:white;
text-align:center;
}

header{
padding:20px;
background:#081733;
}

select,button{
margin-top:15px;
padding:10px;
border-radius:8px;
border:none;
font-size:16px;
}

button{
background:#00BFA5;
color:white;
cursor:pointer;
}

.card{
background:#1565C0;
margin:20px;
padding:20px;
border-radius:15px;
display:none;
}

.nota{
font-size:28px;
font-weight:bold;
margin-top:15px;
}

#map{
height:400px;
margin:20px;
border-radius:15px;
}
canvas{
background:white;
border-radius:15px;
margin:20px;
}
</style>
</head>

<body>

<header>
<h1>ImbiLine ðŸŒŠ</h1>
<p>PrevisÃ£o TÃ©cnica â€¢ Imbituba</p>
</header>

<select id="praia">
<option value="vila|-28.2413,-48.6703">Praia da Vila</option>
<option value="ribanceira|-28.2605,-48.6638">Ribanceira</option>
<option value="itapiruba|-28.3241,-48.7033">ItapirubÃ¡</option>
<option value="barra|-28.1920,-48.6485">Barra de Ibiraquera</option>
</select>

<br>
<button onclick="buscarDados()">Atualizar</button>

<div class="card" id="resultado">
<p id="altura"></p>
<p id="periodo"></p>
<p id="vento"></p>
<p id="direcao"></p>
<div class="nota" id="nota"></div>
<p id="mensagem"></p>
</div>

<canvas id="grafico"></canvas>
<div id="map"></div>

<script>

let chart;

function calcularNota(pico, altura, periodo, dirOnda, vento, dirVento){
let nota = 0;

if(altura >= 1.0) nota += 2;
if(altura >= 1.5) nota += 2;
if(periodo >= 10) nota += 2;
if(periodo >= 13) nota += 1;

if(pico === "vila"){
    if(dirOnda >= 150 && dirOnda <= 210) nota += 2;
    if(dirVento >= 0 && dirVento <= 80) nota += 1;
}

if(pico === "ribanceira"){
    if(dirOnda >= 120 && dirOnda <= 190) nota += 2;
}

if(pico === "itapiruba"){
    if(dirOnda >= 160 && dirOnda <= 220) nota += 2;
}

if(pico === "barra"){
    if(dirOnda >= 140 && dirOnda <= 200) nota += 2;
    if(vento < 8) nota += 1;
}

return Math.min(nota,10);
}

async function buscarDados(){

const selecionado = document.getElementById("praia").value;
const [pico, coords] = selecionado.split("|");
const [lat,lng] = coords.split(",");

const url = `https://marine-api.open-meteo.com/v1/marine?latitude=${lat}&longitude=${lng}&hourly=wave_height,wave_period,wave_direction,windspeed_10m,winddirection_10m&daily=wave_height_max,wave_period_mean&timezone=auto`;

const response = await fetch(url);
const data = await response.json();

const agora = new Date().toISOString().slice(0,13);
const index = data.hourly.time.findIndex(t => t.startsWith(agora));

const altura = data.hourly.wave_height[index];
const periodo = data.hourly.wave_period[index];
const dirOnda = data.hourly.wave_direction[index];
const vento = data.hourly.windspeed_10m[index];
const dirVento = data.hourly.winddirection_10m[index];

const nota = calcularNota(pico, altura, periodo, dirOnda, vento, dirVento);

let mensagem="";
if(nota >= 8) mensagem="ðŸ”¥ ClÃ¡ssico!";
else if(nota >=5) mensagem="ðŸŒŠ SurfÃ¡vel.";
else mensagem="ðŸ˜• Fraco ou mexido.";

document.getElementById("resultado").style.display="block";
document.getElementById("altura").innerText=`Altura: ${altura.toFixed(2)} m`;
document.getElementById("periodo").innerText=`PerÃ­odo: ${periodo.toFixed(1)} s`;
document.getElementById("vento").innerText=`Vento: ${vento.toFixed(1)} km/h`;
document.getElementById("direcao").innerText=`DireÃ§Ã£o Swell: ${dirOnda}Â°`;
document.getElementById("nota").innerText=`Nota: ${nota}/10`;
document.getElementById("mensagem").innerText=mensagem;

if(chart) chart.destroy();

chart = new Chart(document.getElementById("grafico"), {
type: 'line',
data: {
labels: data.daily.time,
datasets: [{
label: 'Altura MÃ¡xima (m)',
data: data.daily.wave_height_max,
tension: 0.3
}]
}
});
}

const map = L.map('map').setView([-28.24, -48.67], 11);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

L.marker([-28.2413,-48.6703]).addTo(map).bindPopup("Praia da Vila");
L.marker([-28.2605,-48.6638]).addTo(map).bindPopup("Ribanceira");
L.marker([-28.3241,-48.7033]).addTo(map).bindPopup("ItapirubÃ¡");
L.marker([-28.1920,-48.6485]).addTo(map).bindPopup("Barra");

</script>

</body>
</html>
