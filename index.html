<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ImbiLine</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:'Poppins',sans-serif;
background:#0A1F44;
color:white;
text-align:center;
}

header{
padding:20px;
background:#081733;
}

select,button{
margin-top:15px;
padding:10px;
border-radius:8px;
border:none;
font-size:16px;
}

button{
background:#00BFA5;
color:white;
cursor:pointer;
}

.card{
background:#1565C0;
margin:20px;
padding:20px;
border-radius:15px;
display:none;
}

canvas{
background:white;
border-radius:15px;
margin:20px;
}
</style>
</head>

<body>

<header>
<h1>ImbiLine ðŸŒŠ</h1>
<p>PrevisÃ£o TÃ©cnica â€¢ Imbituba</p>
</header>

<select id="praia">
<option value="-28.2413,-48.6703">Praia da Vila</option>
<option value="-28.2605,-48.6638">Ribanceira</option>
<option value="-28.3241,-48.7033">ItapirubÃ¡</option>
<option value="-28.1920,-48.6485">Barra</option>
</select>

<br>
<button onclick="buscarDados()">Atualizar</button>

<div class="card" id="resultado">
<p id="resumo"></p>
<p id="melhor"></p>
</div>

<h3>ðŸŒŠ Ondas (24h)</h3>
<canvas id="graficoOndas"></canvas>

<h3>ðŸŒ¬ Vento (24h)</h3>
<canvas id="graficoVento"></canvas>

<script>

let chartOndas;
let chartVento;

function direcaoParaSeta(g){
if(g>=337||g<22) return "â†‘ N";
if(g>=22&&g<67) return "â†— NE";
if(g>=67&&g<112) return "â†’ L";
if(g>=112&&g<157) return "â†˜ SE";
if(g>=157&&g<202) return "â†“ S";
if(g>=202&&g<247) return "â†™ SO";
if(g>=247&&g<292) return "â† O";
return "â†– NO";
}

function melhorHorario(data){
let melhorIndex=0;
let melhorScore=0;

for(let i=0;i<24;i++){
let score=0;
if(data.hourly.wave_height[i]>=1.2) score+=3;
if(data.hourly.wave_period[i]>=11) score+=3;
if(data.hourly.windspeed_10m[i]<10) score+=3;

if(score>melhorScore){
melhorScore=score;
melhorIndex=i;
}
}
return melhorIndex;
}

function corAltura(v){
if(v<0.8) return "#4FC3F7";
if(v<1.2) return "#29B6F6";
if(v<1.8) return "#0288D1";
if(v<2.5) return "#01579B";
return "#002F6C";
}

async function buscarDados(){

const praia=document.getElementById("praia").value;
const [lat,lng]=praia.split(",");

const url=`https://marine-api.open-meteo.com/v1/marine?latitude=${lat}&longitude=${lng}&hourly=wave_height,wave_period,wave_direction,windspeed_10m,winddirection_10m&timezone=auto`;

const res=await fetch(url);
const data=await res.json();

// resumo atual
const alturaAtual=data.hourly.wave_height[0];
const periodoAtual=data.hourly.wave_period[0];
const ventoAtual=data.hourly.windspeed_10m[0];
const dirOndaAtual=data.hourly.wave_direction[0];
const dirVentoAtual=data.hourly.winddirection_10m[0];

const melhor=melhorHorario(data);
const horaMelhor=data.hourly.time[melhor].slice(11,16);

document.getElementById("resultado").style.display="block";
document.getElementById("resumo").innerText=
`Agora: ${alturaAtual.toFixed(1)}m ${direcaoParaSeta(dirOndaAtual)} | PerÃ­odo ${periodoAtual.toFixed(1)}s | Vento ${ventoAtual.toFixed(1)}km/h ${direcaoParaSeta(dirVentoAtual)}`;

document.getElementById("melhor").innerText=`ðŸ”¥ Melhor horÃ¡rio: ${horaMelhor}`;

// grÃ¡fico ondas estilo Windy
if(chartOndas) chartOndas.destroy();

chartOndas=new Chart(document.getElementById("graficoOndas"),{
type:'bar',
data:{
labels:data.hourly.time.slice(0,24).map(t=>t.slice(11,16)),
datasets:[{
label:'Altura (m)',
data:data.hourly.wave_height.slice(0,24),
backgroundColor:data.hourly.wave_height.slice(0,24).map(corAltura)
}]
}
});

// grÃ¡fico vento
if(chartVento) chartVento.destroy();

chartVento=new Chart(document.getElementById("graficoVento"),{
type:'line',
data:{
labels:data.hourly.time.slice(0,24).map(t=>t.slice(11,16)),
datasets:[{
label:'Vento (km/h)',
data:data.hourly.windspeed_10m.slice(0,24)
}]
}
});

}

</script>

</body>
</html>
